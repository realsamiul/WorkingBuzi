
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>M0NARQ · Space Sustainability</title>

<!-- ──  LOCAL FONTS  ───────────────────────────────────────── -->
<link rel="preload" href="EditorialNew-Light.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="SweetSansPro-Medium.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="NeueMontreal-Regular.woff2" as="font" type="font/woff2" crossorigin>

<style>
/* Editorial New – light for hero H1 */
@font-face{font-family:'Editorial New';src:url('EditorialNew-Light.woff2')format('woff2');
  font-style:normal;font-weight:300;font-display:swap}
/* Sweet Sans Pro – body copy */
@font-face{font-family:'Sweet Sans';src:url('SweetSansPro-Medium.woff2')format('woff2');
  font-style:normal;font-weight:500;font-display:swap}
/* Neue Montreal – subheads / UI */
@font-face{font-family:'Neue Montreal';src:url('NeueMontreal-Regular.woff2')format('woff2');
  font-style:normal;font-weight:400;font-display:swap}

:root{
  --brand-red:#c40d2e;
  --teal:#33ffd5;
  --midnight:#050d24;
  --black:#000;
  --text-grey:#b5b5b5;
  --display:'Editorial New',serif;
  --subhead:'Neue Montreal',sans-serif;
  --body:'Sweet Sans',sans-serif;
}

/* ──  GLOBAL  ─────────────────────────────────────────────── */
html,body{height:100%;width:100%;margin:0;overflow-x:hidden;
  font-family:var(--body);
  background:radial-gradient(circle at 50% 20%,var(--midnight) 0%,var(--black) 80%);
  color:#fff;-webkit-font-smoothing:antialiased}

/* ──  PRE-LOADER  ─────────────────────────────────────────── */
#preloader{position:fixed;inset:0;background:#000;display:flex;justify-content:center;align-items:center;flex-direction:column;
  z-index:200;pointer-events:none}
#preloader canvas{width:100%;height:100%;position:absolute;top:0;left:0}
#titleScramble{font-family:'Neue Montreal',sans-serif;font-size:2.2rem;letter-spacing:.25em;z-index:10;color:white;}
#preloader::after{content:'';width:160px;height:160px;border-radius:50%;
  background:radial-gradient(circle,#fff2 0%,transparent 70%);
  position:absolute;mix-blend-mode:overlay;animation:glint 3s infinite}
@keyframes glint{0%{transform:scale(.3)}50%{transform:scale(1)}100%{transform:scale(.3)}}

/* ──  UI CHROME  ──────────────────────────────────────────── */
.ui-layer{position:fixed;inset:0;padding:40px;display:flex;flex-direction:column;justify-content:space-between;pointer-events:none;z-index:10}
.logo{font-family:var(--subhead);letter-spacing:.25em;font-size:1.35rem;text-transform:uppercase;color:white;}
.progress-bar-container{position:fixed;right:50px;top:50%;transform:translateY(-50%);
  width:1px;height:20vh;background:rgba(255,255,255,.18);z-index:20}
.progress-bar-fill{width:100%;height:0;background:var(--brand-red)}

/* ──  SCROLL SECTIONS  ───────────────────────────────────── */
.scroll-content{position:relative;z-index:5}
section{min-height:100vh;display:flex;flex-direction:column;justify-content:center;
  padding:0 15%;box-sizing:border-box;pointer-events:none}
.text-block{max-width:560px;pointer-events:auto;opacity:0;transform:translateY(40px)}

h1{font-family:var(--display);font-weight:300;letter-spacing:.02em;text-transform:uppercase;
  font-size:clamp(3.3rem,6vw,7rem);line-height:1;margin:0 0 2rem}
h2{font-family:var(--subhead);font-weight:400;text-transform:uppercase;letter-spacing:.1em;
  font-size:2rem;margin:0 0 1rem;color:var(--brand-red)}
p{font-family:var(--body);font-weight:500;font-size:1.05rem;line-height:1.8;color:var(--text-grey);margin:0 0 1.4rem}
.big-stat{font-family:var(--subhead);font-size:8rem;line-height:1;margin:0}

#section-intro{align-items:flex-start}
#section-stats{align-items:flex-end;text-align:right}
#section-privateer{align-items:center;text-align:center}
#section-wayfinder{align-items:flex-start}

/* 3-D canvas */
#canvas-container{position:fixed;inset:0;pointer-events:none;z-index:1;opacity:0;transition:opacity 1.5s ease}

@media (max-width: 768px) {
  section { padding: 0 8%; }
  .big-stat { font-size: 4rem; }
  h1 { font-size: clamp(2rem, 8vw, 4rem); }
  .progress-bar-container { right: 20px; }
}
</style>
</head>
<body>

<!-- ── PRE-LOADER ── -->
<div id="preloader">
  <div id="titleScramble">M0NARQ</div>
</div>

<!-- ── UI ── -->
<div class="ui-layer"><div class="logo">M0NARQ</div></div>
<div class="progress-bar-container"><div id="scroll-progress" class="progress-bar-fill"></div></div>

<!-- ── 3-D Earth canvas ── -->
<div id="canvas-container"></div>

<!-- ── CONTENT ── -->
<div class="scroll-content">
  <section id="section-intro">
    <div class="text-block">
      <h1>Planet<br>M0NARQ</h1>
      <p>From silent beeps to high-bandwidth constellations, orbit has evolved. M0NARQ turns that evolution into geospatial insight.</p>
    </div>
  </section>

  <section id="section-stats">
    <div class="text-block">
      <span class="big-stat" id="stat-counter">0</span>
      <h2>Orbital Objects</h2>
      <p>Human-made objects larger than a softball are currently being tracked as they circle Earth.</p>
      <p>24 000 more satellites are scheduled to launch within the next decade.</p>
    </div>
  </section>

  <section id="section-privateer">
    <div class="text-block" style="max-width:800px">
      <h2>M0NARQ × PRIVATEER</h2>
      <p>Together we monitor, assess and verify on-orbit behaviour for a safer, more sustainable space.</p>
    </div>
  </section>

  <section id="section-wayfinder">
    <div class="text-block">
      <h1>Wayfinder</h1>
      <p>An open-access, near-real-time visualisation of satellites and debris—empowering responsible actors across the globe.</p>
    </div>
  </section>
  <div style="height:50vh"></div>
</div>

<!-- ── LIBS (CDN) ── -->
<script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
  }
}
</script>

<!-- GSAP + Plugins via CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrambleTextPlugin.min.js"></script>

<script type="module">
import * as THREE from 'three';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

/* ============================================================
   1.  PRE-LOADER  (Sentinel GLB + GSAP ScrambleText)
============================================================ */
const preCanvas = document.createElement('canvas');
preCanvas.style.cssText = 'width:100%;height:100%;position:absolute;top:0;left:0';
document.getElementById('preloader').appendChild(preCanvas);

const pRend = new THREE.WebGLRenderer({canvas: preCanvas, alpha: true, antialias: true});
pRend.setPixelRatio(Math.min(devicePixelRatio, 2));
pRend.setSize(innerWidth, innerHeight);

const pScene = new THREE.Scene();
const pCam = new THREE.PerspectiveCamera(50, innerWidth / innerHeight, 0.1, 100);
pCam.position.set(0, 0, 4);

// Load environment map (with fallback)
new THREE.TextureLoader().load('milkyway_8k.jpg', 
  t => {
    t.mapping = THREE.EquirectangularReflectionMapping;
    pScene.environment = t;
  },
  undefined,
  error => {
    console.log('Environment map failed to load, using fallback');
    pScene.background = new THREE.Color(0x000000);
  }
);

// Load satellite model
const gltfLoader = new GLTFLoader();
gltfLoader.load('sentinel.glb', 
  glb => {
    const sat = glb.scene;
    sat.scale.set(2, 2, 2);
    pScene.add(sat);
    
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(2, 2, 5);
    pScene.add(light);
    pScene.add(new THREE.AmbientLight(0xffffff, 0.4));
    
    gsap.to(pCam.position, {z: 2, x: 1.2, y: 0.4, duration: 4, ease: 'power1.inOut', delay: 0.5});
    gsap.to(sat.rotation, {y: Math.PI * 2, duration: 6, ease: 'none', repeat: -1});
    
    // Start animation loop
    animatePre();
  },
  undefined,
  error => {
    console.log('Satellite model failed to load:', error);
    // Create a fallback sphere if model fails
    const geometry = new THREE.SphereGeometry(0.5, 16, 16);
    const material = new THREE.MeshStandardMaterial({color: 0x888888});
    const sat = new THREE.Mesh(geometry, material);
    pScene.add(sat);
    
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(2, 2, 5);
    pScene.add(light);
    pScene.add(new THREE.AmbientLight(0xffffff, 0.4));
    
    gsap.to(pCam.position, {z: 2, x: 1.2, y: 0.4, duration: 4, ease: 'power1.inOut', delay: 0.5});
    gsap.to(sat.rotation, {y: Math.PI * 2, duration: 6, ease: 'none', repeat: -1});
    
    animatePre();
  }
);

function animatePre() {
  if (pRend && pScene && pCam) {
    pRend.render(pScene, pCam);
    requestAnimationFrame(animatePre);
  }
}

// GSAP ScrambleText animation
gsap.registerPlugin(ScrambleTextPlugin);
gsap.fromTo('#titleScramble', 
  {scrambleText: {text: '', chars: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', speed: 0.35}},
  {duration: 2, scrambleText: {text: 'M0NARQ', revealDelay: 0}, onComplete: finishPreloader}
);

function finishPreloader() {
  gsap.to('#preloader', {
    opacity: 0, 
    duration: 0.8, 
    ease: 'power2.inOut', 
    onComplete: () => {
      const preloader = document.getElementById('preloader');
      if (preloader) {
        preloader.style.display = 'none';
      }
      initMainScene();
    }
  });
}

/* ============================================================
   2.  MAIN SCENE
============================================================ */
function initMainScene() {
  const cont = document.getElementById('canvas-container');
  if (!cont) return;
  
  const renderer = new THREE.WebGLRenderer({alpha: true, antialias: true});
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(Math.min(devicePixelRatio, 1.75));
  renderer.toneMapping = THREE.ACESFilmicToneMapping;
  renderer.toneMappingExposure = 1.2;
  cont.appendChild(renderer.domElement);

  const scene = new THREE.Scene();
  const cam = new THREE.PerspectiveCamera(45, innerWidth / innerHeight, 0.1, 1000);
  cam.position.set(0, 0, 18);

  /* ── Texture loading with fallbacks ── */
  const tex = {};
  const loadedTextures = {};
  const totalTextures = 7;
  let loadedCount = 0;
  
  function onTextureLoaded() {
    loadedCount++;
    if (loadedCount === totalTextures) {
      cont.style.opacity = 1;
      startScrollAnim();
      render();
    }
  }
  
  const tl = new THREE.TextureLoader();
  
  // Load textures with callbacks
  tex.alb = tl.load('albedo_8k.jpg', onTextureLoaded, undefined, () => {
    console.log('Albedo texture failed to load');
    onTextureLoaded();
  });
  tex.nit = tl.load('night_8k.jpg', onTextureLoaded, undefined, () => {
    console.log('Night texture failed to load');
    onTextureLoaded();
  });
  tex.cld = tl.load('clouds_4k.webp', onTextureLoaded, undefined, () => {
    console.log('Clouds texture failed to load');
    onTextureLoaded();
  });
  tex.sta = tl.load('milkyway_8k.jpg', t => {
    t.mapping = THREE.EquirectangularReflectionMapping;
    onTextureLoaded();
  }, undefined, () => {
    console.log('Stars texture failed to load');
    onTextureLoaded();
  });
  tex.nrm = tl.load('normal_4k.jpg', onTextureLoaded, undefined, () => {
    console.log('Normal texture failed to load');
    onTextureLoaded();
  });
  tex.spe = tl.load('spec_4k.jpg', onTextureLoaded, undefined, () => {
    console.log('Specular texture failed to load');
    onTextureLoaded();
  });
  tex.rou = tl.load('rough_4k.jpg', onTextureLoaded, undefined, () => {
    console.log('Roughness texture failed to load');
    onTextureLoaded();
  });

  /* ── Earth group ── */
  const g = new THREE.Group();
  scene.add(g);
  
  const earthMat = new THREE.MeshStandardMaterial({
    map: tex.alb,
    normalMap: tex.nrm,
    metalnessMap: tex.spe,
    roughnessMap: tex.rou,
    emissiveMap: tex.nit,
    emissive: new THREE.Color('#222')
  });
  const earth = new THREE.Mesh(new THREE.SphereGeometry(5, 64, 64), earthMat);
  g.add(earth);
  
  // Clouds
  const clouds = new THREE.Mesh(
    new THREE.SphereGeometry(5.05, 64, 64),
    new THREE.MeshLambertMaterial({map: tex.cld, transparent: true, opacity: 0.4, side: THREE.DoubleSide})
  );
  g.add(clouds);
  
  // Atmosphere glow
  const atmosphereMat = new THREE.ShaderMaterial({
    vertexShader: `
      varying vec3 vNormal;
      void main() {
        vNormal = normalize(normalMatrix * normal);
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,
    fragmentShader: `
      varying vec3 vNormal;
      void main() {
        float intensity = pow(0.55 - dot(vNormal, vec3(0, 0, 1.0)), 4.0);
        gl_FragColor = vec4(0.3, 0.6, 1.0, 1.0) * intensity * 1.7;
      }
    `,
    side: THREE.BackSide,
    blending: THREE.AdditiveBlending,
    transparent: true
  });
  g.add(new THREE.Mesh(new THREE.SphereGeometry(5.2, 64, 64), atmosphereMat));

  /* ── Stars ── */
  function createStarSphere(radius, opacity) {
    const mesh = new THREE.Mesh(
      new THREE.SphereGeometry(radius, 64, 64),
      new THREE.MeshBasicMaterial({map: tex.sta, side: THREE.BackSide, transparent: true, opacity: opacity})
    );
    scene.add(mesh);
    return mesh;
  }
  const sNear = createStarSphere(90, 0.28);
  const sFar = createStarSphere(120, 0.55);

  /* ── Debris ── */
  const dCnt = devicePixelRatio < 1.5 ? 12000 : 27000;
  const pos = [];
  for (let i = 0; i < dCnt; i++) {
    const r = 5.5 + Math.random() * 2.4;
    const t = Math.random() * 2 * Math.PI;
    const p = Math.acos(2 * Math.random() - 1);
    pos.push(r * Math.sin(p) * Math.cos(t), r * Math.sin(p) * Math.sin(t), r * Math.cos(p));
  }
  const dGeo = new THREE.BufferGeometry().setAttribute('position', new THREE.Float32BufferAttribute(pos, 3));
  const dMat = new THREE.PointsMaterial({color: '#ffffff', size: 0.03, transparent: true, opacity: 0});
  const debris = new THREE.Points(dGeo, dMat);
  scene.add(debris);

  /* ── Arcs ── */
  const arcGrp = new THREE.Group();
  scene.add(arcGrp);
  const ARC_MAX = devicePixelRatio < 1.5 ? 25 : 48;
  
  setInterval(() => {
    if (arcGrp.children.length < ARC_MAX) addArc();
  }, 400);
  
  function addArc() {
    const r = 6 + Math.random() * 1.5;
    const points = [...Array(30)].map(() => 
      new THREE.Vector3().setFromSphericalCoords(r, Math.random() * Math.PI, Math.random() * 2 * Math.PI)
    );
    const curve = new THREE.CatmullRomCurve3(points);
    const geo = new THREE.TubeGeometry(curve, 20, 0.02, 8, false);
    const mat = new THREE.MeshBasicMaterial({color: getComputedStyle(document.documentElement).getPropertyValue('--teal').trim(), transparent: true, opacity: 0});
    const mesh = new THREE.Mesh(geo, mat);
    arcGrp.add(mesh);
    
    gsap.fromTo(mat, {opacity: 0}, {
      opacity: 0.9, 
      duration: 0.6, 
      ease: 'power2.out', 
      yoyo: true, 
      repeat: 1, 
      repeatDelay: 0.8,
      onComplete: () => {
        if (arcGrp.children.includes(mesh)) {
          arcGrp.remove(mesh);
        }
        geo.dispose();
        mat.dispose();
      }
    });
  }

  /* ── Lights ── */
  scene.environment = tex.sta;
  const sunLight = new THREE.DirectionalLight(0xffffff, 1);
  sunLight.position.set(20, 10, 10);
  scene.add(sunLight);
  scene.add(new THREE.AmbientLight(0xffffff, 0.15));

  /* ── Resize ── */
  function handleResize() {
    cam.aspect = innerWidth / innerHeight;
    cam.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  }
  window.addEventListener('resize', handleResize);

  /* ── Render loop ── */
  const clk = new THREE.Clock();
  let animationId = null;
  
  function render() {
    if (!renderer || !scene || !cam) return;
    
    const d = clk.getDelta() * 60;
    g.rotation.y += 0.0015 * d;
    clouds.rotation.y += 0.0005 * d;
    if (arcGrp) arcGrp.rotation.y += 0.0006 * d;
    if (sNear) sNear.rotation.y -= 0.0002;
    if (sFar) sFar.rotation.y -= 0.00012;
    if (debris) debris.rotation.y += 0.0003 * d;
    
    renderer.render(scene, cam);
    animationId = requestAnimationFrame(render);
  }

  /* ── ScrollTriggers ── */
  function startScrollAnim() {
    gsap.registerPlugin(ScrollTrigger);
    
    // Animate text blocks
    document.querySelectorAll('.text-block').forEach(el => {
      gsap.to(el, {
        opacity: 1, 
        y: 0, 
        duration: 1.1, 
        ease: 'cubic-bezier(.6,0,.2,1)',
        scrollTrigger: {
          trigger: el, 
          start: 'top 80%', 
          end: 'bottom 20%',
          toggleActions: 'play none none reverse'
        }
      });
    });

    // Camera animation timeline
    const timeline = gsap.timeline({
      scrollTrigger: {
        trigger: '.scroll-content', 
        start: 'top top', 
        end: 'bottom bottom', 
        scrub: 1.2,
        markers: false // Set to true for debugging
      }
    });
    
    timeline
      .to(cam.position, {z: 12, y: 2, ease: 'power1.inOut'}, 0)
      .to(dMat, {opacity: 0.8, duration: 1.5}, 0.4)
      .to(cam.position, {x: -5, z: 9, duration: 4}, 0.33)
      .to(cam.position, {x: 0, y: 10, z: 0, duration: 4}, 0.66)
      .to(cam.rotation, {x: -Math.PI / 2, y: 0, z: 0, duration: 4}, 0.66);

    // Counter animation
    ScrollTrigger.create({
      trigger: '#section-stats',
      start: 'top center',
      onEnter: () => {
        const o = {v: 0};
        gsap.to(o, {
          v: 27000, 
          duration: 2, 
          ease: 'power2.out',
          onUpdate: () => {
            const counter = document.getElementById('stat-counter');
            if (counter) {
              counter.textContent = Math.floor(o.v).toLocaleString();
            }
          }
        });
      },
      once: true
    });

    // Progress bar animation
    gsap.to('#scroll-progress', {
      height: '100%', 
      ease: 'none',
      scrollTrigger: {
        trigger: '.scroll-content', 
        start: 'top top', 
        end: 'bottom bottom', 
        scrub: 0
      }
    });
  }
  
  // Cleanup function
  window.addEventListener('beforeunload', () => {
    if (animationId) {
      cancelAnimationFrame(animationId);
    }
    ScrollTrigger.getAll().forEach(trigger => trigger.kill());
  });
}
</script>
</body>
</html>
