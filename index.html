<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Venturi Space | Mission Control</title>
    
    <!-- Fonts - Using Google Fonts proxies for Supermolot/Suisse -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;600&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* --- EXTRACTED VENTURI CSS & VARIABLES --- */
        :root {
            --black: 4, 4, 4;
            --body: 4, 4, 4;
            --text: 244, 244, 244;
            --white: 255, 255, 255;
            --orange: 255, 53, 9; /* Venturi Orange */
            --grey: 26, 26, 26;
            --gutter: 2rem;
            --flux_large: 140rem;
            --ease: cubic-bezier(0.25, 0, 0.25, 1);
            --font-display: 'Barlow', sans-serif; /* Proxy for Suisse */
            --font-tech: 'Rajdhani', sans-serif; /* Proxy for Supermolot */
        }

        body {
            margin: 0;
            padding: 0;
            background-color: rgb(var(--body));
            color: rgb(var(--text));
            overflow-x: hidden;
            font-family: var(--font-display);
            -webkit-font-smoothing: antialiased;
        }

        /* --- TYPOGRAPHY UTILITIES (c-font) --- */
        [c-font*="yell_1"] {
            font-family: var(--font-tech);
            font-size: clamp(3rem, 8vw, 12.5rem);
            line-height: 0.9;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        [c-font*="title_2"] {
            font-family: var(--font-tech);
            font-size: clamp(2rem, 5vw, 5.5rem);
            line-height: 0.96;
            text-transform: uppercase;
            font-weight: 600;
        }

        [c-font*="label_1"] {
            font-family: var(--font-tech);
            font-size: 1.5rem;
            letter-spacing: 0.03em;
            text-transform: uppercase;
        }

        [c-font*="body_3"] {
            font-size: 1.3rem;
            line-height: 1.25;
        }

        /* --- PRELOADER STYLES (Exact Replica) --- */
        .loader {
            position: fixed;
            inset: 0;
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none; /* Allow click through after */
        }

        .loader-fill {
            position: fixed;
            inset: 0;
            background: rgb(var(--body));
            transition: transform 1s var(--ease);
            transform-origin: top;
        }

        .loader-data {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            transition: opacity 0.5s var(--ease);
        }

        .loader.hidden .loader-fill { transform: scaleY(0); }
        .loader.hidden .loader-data { opacity: 0; }

        .loader-status {
            font-family: var(--font-tech);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 1.5em;
            overflow: hidden;
        }

        .loader-status span {
            display: block;
            transition: transform 0.5s var(--ease);
        }

        /* Logic for swapping text */
        .loader-status.launching .loader-prepare { transform: translateY(-100%); }
        .loader-status.launching .loader-ready { transform: translateY(-100%); }

        .loader-countdown {
            display: flex;
            align-items: center;
            font-family: var(--font-tech);
            font-variant-numeric: tabular-nums;
        }

        .loader-bars {
            width: 3.9rem;
            margin-right: 1rem;
        }

        .loader-bars rect {
            fill: rgba(255, 255, 255, 0.5);
            animation: pulse 2s steps(3) infinite;
        }
        /* Staggered pulse from CSS file */
        .loader-bars rect:nth-child(1) { animation-delay: 0.23s; }
        .loader-bars rect:nth-child(2) { animation-delay: 0.46s; }
        .loader-bars rect:nth-child(3) { animation-delay: 0.69s; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.2; }
        }

        /* --- 3D CONTAINER --- */
        #scene-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1;
            opacity: 0;
            transition: opacity 2s var(--ease);
        }

        /* --- SCROLL SECTIONS --- */
        .scroll-container {
            position: relative;
            z-index: 10;
        }

        .section {
            height: 150vh; /* Scrubbing space */
            display: flex;
            align-items: center;
            padding: 0 10%;
            position: relative;
            pointer-events: none; /* Let clicks pass to canvas */
        }

        .content-box {
            max-width: 60rem;
            pointer-events: auto;
            transform: translateY(50px);
            opacity: 0;
            transition: all 1s var(--ease);
        }
        
        .section.active .content-box {
            opacity: 1;
            transform: translateY(0);
        }

        .label {
            color: rgb(var(--orange));
            border: 1px solid rgb(var(--orange));
            padding: 0.5rem 1rem;
            display: inline-block;
            margin-bottom: 2rem;
            font-family: var(--font-tech);
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.1em;
        }

        p { opacity: 0.7; max-width: 40ch; margin-top: 1rem; font-size: 1.1rem; line-height: 1.5; }

        /* HUD Elements */
        .coords-hud {
            position: fixed;
            bottom: 3rem;
            right: 3rem;
            text-align: right;
            font-family: var(--font-tech);
            z-index: 20;
            opacity: 0;
            transition: opacity 1s var(--ease);
        }
        .coords-hud h4 { color: rgb(var(--orange)); text-transform: uppercase; letter-spacing: 2px; }
        .coords-hud span { font-size: 2rem; font-weight: 600; display: block; }

    </style>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/",
                "three-globe": "https://unpkg.com/three-globe@2.31.0/dist/three-globe.module.js",
                "gsap": "https://unpkg.com/gsap@3.12.5/index.js",
                "gsap/ScrollTrigger": "https://unpkg.com/gsap@3.12.5/ScrollTrigger.js"
            }
        }
    </script>
</head>
<body>

    <!-- PRELOADER (Venturi Style) -->
    <div class="loader">
        <div class="loader-fill"></div>
        <div class="loader-data">
            <!-- Simplified Logo SVG -->
            <svg class="asset loader-logo" width="200" height="40" viewBox="0 0 200 40" xmlns="http://www.w3.org/2000/svg">
                <path d="M10,10 L30,30 L50,10" fill="none" stroke="white" stroke-width="4"/>
                <rect x="60" y="10" width="130" height="20" fill="white" opacity="0.2"/>
            </svg>
            
            <div class="loader-status">
                <span class="loader-prepare" c-font="body_3">Ready for launch</span>
                <span class="loader-ready" c-font="body_3">Take-off</span>
            </div>
            
            <div class="loader-countdown">
                <svg class="asset loader-bars" width="39" height="10" viewBox="0 0 39 10" fill="none">
                    <rect opacity="0.2" width="1" height="10" x="38" fill="#D9D9D9"></rect>
                    <rect opacity="0.6" width="1" height="10" x="22" fill="#D9D9D9"></rect>
                    <rect opacity="0.3" width="2" height="10" x="26" fill="#D9D9D9"></rect>
                    <rect opacity="0.8" width="3" height="10" x="8" fill="#D9D9D9"></rect>
                    <rect opacity="0.1" width="4" height="10" x="34" fill="#D9D9D9"></rect>
                </svg>
                <span class="loader-time">00:10:00</span>
            </div>
        </div>
    </div>

    <!-- 3D SCENE -->
    <div id="scene-container"></div>

    <!-- HUD -->
    <div class="coords-hud" id="hud">
        <h4>Target Coordinates</h4>
        <span id="coord-display">00°00'00" N</span>
    </div>

    <!-- SCROLL CONTENT -->
    <div class="scroll-container">
        
        <!-- 1. Deep Space -->
        <section class="section" id="sec-1">
            <div class="content-box">
                <span class="label">Phase 01</span>
                <h1 c-font="yell_1">Orbital<br>Injection</h1>
                <p>The Sentinel satellite stabilizes in high Earth orbit. Systems diagnostic complete. Establishing downlink.</p>
            </div>
        </section>

        <!-- 2. Earth Approach -->
        <section class="section" id="sec-2">
            <div class="content-box" style="margin-left: auto; text-align: right;">
                <span class="label">Phase 02</span>
                <h2 c-font="title_2">Earth Observation</h2>
                <p>Visual confirmation of the Blue Marble. Atmospheric sensors active. Preparing for data overlay.</p>
            </div>
        </section>

        <!-- 3. Data Viz -->
        <section class="section" id="sec-3">
            <div class="content-box">
                <span class="label">Analysis</span>
                <h2 c-font="title_2">Population Density</h2>
                <p>Hex-bin aggregation reveals human activity clusters. Thermal signatures correlate with energy consumption.</p>
            </div>
        </section>

        <!-- 4. Bangladesh Zoom -->
        <section class="section" id="sec-4">
            <div class="content-box" style="margin-left: auto;">
                <span class="label">Target Acquired</span>
                <h1 c-font="title_2">Dhaka, Bangladesh</h1>
                <p>Precision coordinates locked. High-resolution scanning initiated at 23.68° N, 90.35° E.</p>
            </div>
        </section>

        <!-- 5. Transit to Moon -->
        <section class="section" id="sec-5">
            <div class="content-box">
                <span class="label">Phase 03</span>
                <h2 c-font="title_2">Lunar Transfer</h2>
                <p>Leaving Earth orbit. Calculating trajectory for lunar injection. Destination: South Pole-Aitken basin.</p>
            </div>
        </section>

        <!-- 6. Moon Arrival -->
        <section class="section" id="sec-6">
            <div class="content-box" style="text-align: center; margin: auto;">
                <span class="label">Destination</span>
                <h1 c-font="yell_1">The Moon</h1>
                <p>Orbit established. Venturi FLEX rover deployment sequence armed. Exploring the dark side.</p>
            </div>
        </section>

        <div style="height: 50vh;"></div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import ThreeGlobe from 'three-globe';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import gsap from 'gsap';
        import { ScrollTrigger } from 'gsap/ScrollTrigger';

        gsap.registerPlugin(ScrollTrigger);

        // --- PRELOADER LOGIC ---
        const loader = document.querySelector('.loader');
        const loaderStatus = document.querySelector('.loader-status');
        const loaderTime = document.querySelector('.loader-time');
        let timeLeft = 10.0; // 10 seconds (virtual)
        
        // Simulate the countdown logic from the JS file
        const timerInterval = setInterval(() => {
            timeLeft -= 0.1; // Decrement
            if (timeLeft <= 0) {
                timeLeft = 0;
                clearInterval(timerInterval);
                launchSequence();
            }
            
            // Format time 00:XX:XX
            const seconds = Math.floor(timeLeft);
            const ms = Math.floor((timeLeft % 1) * 100);
            loaderTime.textContent = `00:${seconds.toString().padStart(2, '0')}:${ms.toString().padStart(2, '0')}`;
        }, 30); // Fast ticks

        function launchSequence() {
            // Text Swap Animation
            loaderStatus.classList.add('launching');
            
            // Reveal delay
            setTimeout(() => {
                loader.classList.add('hidden');
                document.getElementById('scene-container').style.opacity = 1;
                initExperience(); // Start 3D logic
            }, 1000);
        }

        // --- 3D SCENE SETUP ---
        const container = document.getElementById('scene-container');
        const scene = new THREE.Scene();
        // Venturi uses deep black backgrounds, maybe a very subtle starfield
        scene.background = new THREE.Color(0x040404);
        scene.fog = new THREE.FogExp2(0x040404, 0.002);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 4000);
        camera.position.set(0, 0, 400);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        container.appendChild(renderer.domElement);

        // --- SCENE OBJECTS ---

        // 1. Group for Earth System
        const earthGroup = new THREE.Group();
        scene.add(earthGroup);

        // EARTH (Using ThreeGlobe)
        const Earth = new ThreeGlobe()
            .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
            .bumpImageUrl('https://unpkg.com/three-globe/example/img/earth-topology.png')
            .atmosphereColor('rgb(60, 100, 255)')
            .atmosphereAltitude(0.2);
        
        earthGroup.add(Earth);

        // Data for Earth (Hexagons)
        const N_DATA = 1500;
        const earthData = [...Array(N_DATA).keys()].map(() => ({
            lat: (Math.random() - 0.5) * 160, // Avoid poles
            lng: (Math.random() - 0.5) * 360,
            size: Math.random()
        }));
        
        Earth.hexBinPointsData(earthData)
             .hexBinPointWeight('size')
             .hexBinResolution(3)
             .hexMargin(0.2)
             .hexBinColor(() => 'rgba(255, 53, 9, 0)') // Venturi Orange, invisible start
             .hexAltitude(0); // Flat start

        // 2. Group for Moon System
        // We place it far away initially or hide it
        const moonGroup = new THREE.Group();
        moonGroup.visible = false; 
        scene.add(moonGroup);

        // MOON (Another ThreeGlobe instance)
        // Using a dark lunar texture
        const Moon = new ThreeGlobe()
            .globeImageUrl('https://raw.githubusercontent.com/vasturiano/three-globe/master/example/img/moon.jpg')
            .bumpImageUrl('https://raw.githubusercontent.com/vasturiano/three-globe/master/example/img/moon-topology.png')
            .showAtmosphere(false); // Moon has no atmosphere
        
        moonGroup.add(Moon);

        // 3. SATELLITE (Sentinel)
        const satGroup = new THREE.Group();
        scene.add(satGroup);

        // Create a geometric placeholder in Venturi style (Metallic/Orange)
        const satGeo = new THREE.BoxGeometry(2, 2, 4);
        const satMat = new THREE.MeshStandardMaterial({ 
            color: 0xff3509, // Venturi Orange
            roughness: 0.4, 
            metalness: 0.8 
        });
        const satellite = new THREE.Mesh(satGeo, satMat);
        
        // Solar Panels
        const panelGeo = new THREE.PlaneGeometry(12, 3);
        const panelMat = new THREE.MeshStandardMaterial({ 
            color: 0x111111, 
            roughness: 0.2, 
            metalness: 0.9,
            side: THREE.DoubleSide
        });
        const panels = new THREE.Mesh(panelGeo, panelMat);
        panels.rotation.x = Math.PI / 2;
        satellite.add(panels);
        satGroup.add(satellite);

        // Try Loading GLB if available
        const gltfLoader = new GLTFLoader();
        gltfLoader.load('./assets/sentinel.glb', (gltf) => {
            const model = gltf.scene;
            model.scale.set(3,3,3);
            satellite.visible = false; // Hide placeholder
            panels.visible = false;
            satGroup.add(model);
        }, undefined, (err) => { console.log('Using placeholder satellite'); });


        // --- LIGHTING ---
        const ambientLight = new THREE.AmbientLight(0x404040, 1);
        scene.add(ambientLight);
        
        const dirLight = new THREE.DirectionalLight(0xffffff, 3);
        dirLight.position.set(-100, 100, 200);
        scene.add(dirLight);

        // Venturi style accent light
        const orangeLight = new THREE.PointLight(0xff3509, 2, 500);
        orangeLight.position.set(50, -50, 100);
        scene.add(orangeLight);


        // --- ANIMATION CONTROLLER ---

        function initExperience() {
            // Initial Positions
            satGroup.position.set(60, 30, 150); // Close to camera
            satGroup.rotation.set(0.5, 1, 0);

            // Timeline linked to scroll
            const tl = gsap.timeline({
                scrollTrigger: {
                    trigger: ".scroll-container",
                    start: "top top",
                    end: "bottom bottom",
                    scrub: 1.5 // Venturi-style smooth scrubbing
                }
            });

            // STEP 1: Satellite drift -> Earth Reveal
            tl.to(satGroup.position, {
                x: 0, y: 0, z: 120, // Move sat towards Earth orbit
                duration: 5,
                ease: "power2.inOut"
            }, "start")
            .to(camera.position, {
                z: 250, // Move camera closer to Earth
                duration: 5,
                ease: "power2.inOut",
                onStart: () => document.getElementById('sec-1').classList.add('active')
            }, "start");

            // STEP 2: Rotate Earth & Show Data
            tl.to(earthGroup.rotation, {
                y: 2.5, // Spin Earth
                duration: 5,
                ease: "none",
                onStart: () => {
                    document.getElementById('sec-2').classList.add('active');
                    document.getElementById('hud').style.opacity = 1;
                }
            }, "data")
            .to(camera.position, {
                x: 30, y: 30, z: 180, // Angle view
                duration: 5
            }, "data")
            // Reveal Hex Data (Population)
            .to({}, {
                duration: 1,
                onStart: () => {
                    document.getElementById('sec-3').classList.add('active');
                    Earth.hexBinColor(d => `rgba(255, 53, 9, ${d.size})`) // Orange
                         .hexAltitude(d => d.size * 0.4);
                    // Update HUD
                    document.getElementById('coord-display').innerText = "POPULATION DENSITY";
                }
            }, "data+=2");

            // STEP 3: Zoom to Bangladesh
            // Coordinates of Dhaka: 23.8, 90.4
            // We need to rotate the earth so Dhaka faces the camera (0,0,1)
            // Or rotate the earth group.
            // Simplified: Rotate Group
            
            tl.to(earthGroup.rotation, {
                x: 0.41, // Approx Lat tilt 
                y: 4.8,  // Approx Long rotation (tuned visually)
                duration: 4,
                ease: "power3.inOut",
                onStart: () => {
                    document.getElementById('sec-4').classList.add('active');
                    // Reset Hex for cleanliness
                    Earth.hexBinColor(() => 'transparent').hexAltitude(0);
                    document.getElementById('coord-display').innerText = "23.68° N, 90.35° E";
                }
            }, "zoom")
            .to(camera.position, {
                z: 130, // Zoom in
                duration: 4,
                ease: "power3.inOut"
            }, "zoom");

            // STEP 4: Transition to Moon Scene
            // This needs to be seamless. We will pull camera back, hide Earth, show Moon.
            
            tl.to(camera.position, {
                z: 500, // Pull way back
                duration: 3,
                ease: "power2.in"
            }, "transit")
            .to(earthGroup.scale, {
                x: 0, y: 0, z: 0, // Shrink Earth into nothing
                duration: 1.5,
                ease: "expo.in"
            }, "transit+=1.5")
            .call(() => {
                earthGroup.visible = false;
                moonGroup.visible = true;
                moonGroup.scale.set(0,0,0);
                moonGroup.rotation.y = Math.PI; // Dark side initially?
            })
            .to(moonGroup.scale, {
                x: 1, y: 1, z: 1, // Grow Moon
                duration: 1.5,
                ease: "expo.out"
            }, "transit+=3")
            .to(camera.position, {
                z: 200, // Approach Moon
                duration: 3,
                ease: "power2.out",
                onStart: () => {
                    document.getElementById('sec-5').classList.add('active');
                    document.getElementById('coord-display').innerText = "LUNAR TRANSFER";
                }
            }, "transit+=3");

            // STEP 5: Moon Orbit & Rover
            tl.to(moonGroup.rotation, {
                y: Math.PI + 1, // Rotate Moon
                duration: 5,
                ease: "none",
                onStart: () => {
                    document.getElementById('sec-6').classList.add('active');
                    document.getElementById('coord-display').innerText = "SOUTH POLE AITKEN";
                }
            }, "moon")
            .to(satGroup.position, {
                x: -50, y: 20, z: 100, // Bring Satellite back into view orbiting Moon
                duration: 4,
                ease: "power2.out"
            }, "moon");

        }

        // --- RENDER LOOP ---
        const clock = new THREE.Clock();
        
        function animate() {
            const time = clock.getElapsedTime();

            // Subtle idle animations
            satGroup.rotation.y = time * 0.1;
            satGroup.rotation.z = Math.sin(time * 0.2) * 0.1;
            
            // Add a slight floating feel to camera
            // camera.position.y += Math.sin(time) * 0.05;

            // Stars Background (Manual to avoid texture loading issues)
            // Note: In production, use a large sphere with star texture or points. 
            // For now, simple color background is clean and Venturi-like.

            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }
        
        animate();

        // Resize Handler
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>


